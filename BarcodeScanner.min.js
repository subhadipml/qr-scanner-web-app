BarcodeScanner={Config:{Multiple:!0,DecodeFormats:["Code128","Code93","Code39","EAN-13","2Of5","Inter2Of5","Codabar"],ForceUnique:!0,LocalizationFeedback:!1,SkipOrientation:!1},SupportedFormats:["Code128","Code93","Code39","EAN-13","2Of5","Inter2Of5","Codabar"],ScanCanvas:null,ScanContext:null,SquashCanvas:document.createElement("canvas"),ImageCallback:null,streamCallback:null,LocalizationCallback:null,Stream:null,DecodeStreamActive:!1,Decoded:[],DecoderWorker:new Worker("DecoderWorker.js"),OrientationCallback:null,init:function(){BarcodeScanner.ScanCanvas=BarcodeScanner.FixCanvas(document.createElement("canvas")),BarcodeScanner.ScanCanvas.width=640,BarcodeScanner.ScanCanvas.height=480,BarcodeScanner.ScanContext=BarcodeScanner.ScanCanvas.getContext("2d")},SetRotationSkip:function(a){BarcodeScanner.Config.SkipOrientation=a},SetImageCallback:function(a){BarcodeScanner.ImageCallback=a},setStreamCallback:function(a){BarcodeScanner.streamCallback=a},SetLocalizationCallback:function(a){BarcodeScanner.LocalizationCallback=a,BarcodeScanner.Config.LocalizationFeedback=!0},SwitchLocalizationFeedback:function(a){BarcodeScanner.Config.LocalizationFeedback=a},DecodeSingleBarcode:function(){BarcodeScanner.Config.Multiple=!1},DecodeMultiple:function(){BarcodeScanner.Config.Multiple=!0},SetDecodeFormats:function(a){BarcodeScanner.Config.DecodeFormats=[];for(var e=0;e<a.length;e++)-1!=BarcodeScanner.SupportedFormats.indexOf(a[e])&&BarcodeScanner.Config.DecodeFormats.push(a[e]);0==BarcodeScanner.Config.DecodeFormats.length&&(BarcodeScanner.Config.DecodeFormats=BarcodeScanner.SupportedFormats.slice())},SkipFormats:function(a){for(var e=0;e<a.length;e++){var n=BarcodeScanner.Config.DecodeFormats.indexOf(a[e]);n>=0&&BarcodeScanner.Config.DecodeFormats.splice(n,1)}},AddFormats:function(a){for(var e=0;e<a.length;e++)-1!=BarcodeScanner.SupportedFormats.indexOf(a[e])&&-1==BarcodeScanner.Config.DecodeFormats.indexOf(a[e])&&BarcodeScanner.Config.DecodeFormats.push(a[e])},BarcodeScannerImageCallback:function(a){if("localization"!=a.data.success)if("orientationData"!=a.data.success){for(var e=[],n=0;n<a.data.result.length;n++)-1!=BarcodeScanner.Decoded.indexOf(a.data.result[n].Value)&&0!=BarcodeScanner.Config.ForceUnique||(e.push(a.data.result[n]),BarcodeScanner.Config.ForceUnique&&BarcodeScanner.Decoded.push(a.data.result[n].Value));BarcodeScanner.ImageCallback(e),BarcodeScanner.Decoded=[]}else BarcodeScanner.OrientationCallback(a.data.result);else BarcodeScanner.Config.LocalizationFeedback&&BarcodeScanner.LocalizationCallback(a.data.result)},BarcodeScannerStreamCallback:function(a){if("localization"!=a.data.success){if(a.data.success&&BarcodeScanner.DecodeStreamActive){for(var e=[],n=0;n<a.data.result.length;n++)-1!=BarcodeScanner.Decoded.indexOf(a.data.result[n].Value)&&0!=BarcodeScanner.ForceUnique||(e.push(a.data.result[n]),BarcodeScanner.ForceUnique&&BarcodeScanner.Decoded.push(a.data.result[n].Value));e.length>0&&BarcodeScanner.streamCallback(e)}BarcodeScanner.DecodeStreamActive&&(BarcodeScanner.ScanContext.drawImage(BarcodeScanner.Stream,0,0,BarcodeScanner.ScanCanvas.width,BarcodeScanner.ScanCanvas.height),BarcodeScanner.DecoderWorker.postMessage({scan:BarcodeScanner.ScanContext.getImageData(0,0,BarcodeScanner.ScanCanvas.width,BarcodeScanner.ScanCanvas.height).data,scanWidth:BarcodeScanner.ScanCanvas.width,scanHeight:BarcodeScanner.ScanCanvas.height,multiple:BarcodeScanner.Config.Multiple,decodeFormats:BarcodeScanner.Config.DecodeFormats,cmd:"normal",rotation:1})),BarcodeScanner.DecodeStreamActive||(BarcodeScanner.Decoded=[])}else BarcodeScanner.Config.LocalizationFeedback&&BarcodeScanner.LocalizationCallback(a.data.result)},DecodeImage:function(a){if(a instanceof Image||a instanceof HTMLImageElement)if(a.exifdata=!1,a.complete)BarcodeScanner.Config.SkipOrientation?BarcodeScanner.BarcodeScannerDecodeImage(a,1,""):EXIF.getData(a,function(a){var e=EXIF.getTag(a,"Orientation"),n=EXIF.getTag(a,"SceneCaptureType");"number"!=typeof e&&(e=1),BarcodeScanner.BarcodeScannerDecodeImage(a,e,n)});else{var e=new Image;e.onload=function(){BarcodeScanner.Config.SkipOrientation?BarcodeScanner.BarcodeScannerDecodeImage(e,1,""):EXIF.getData(this,function(a){var e=EXIF.getTag(a,"Orientation"),n=EXIF.getTag(a,"SceneCaptureType");"number"!=typeof e&&(e=1),BarcodeScanner.BarcodeScannerDecodeImage(a,e,n)})},e.src=a.src}else{e=new Image;e.onload=function(){BarcodeScanner.Config.SkipOrientation?BarcodeScanner.BarcodeScannerDecodeImage(e,1,""):EXIF.getData(this,function(a){var e=EXIF.getTag(a,"Orientation"),n=EXIF.getTag(a,"SceneCaptureType");"number"!=typeof e&&(e=1),BarcodeScanner.BarcodeScannerDecodeImage(a,e,n)})},e.src=a}},DecodeStream:function(a){BarcodeScanner.Stream=a,BarcodeScanner.DecodeStreamActive=!0,BarcodeScanner.DecoderWorker.onmessage=BarcodeScanner.BarcodeScannerStreamCallback,BarcodeScanner.ScanContext.drawImage(a,0,0,BarcodeScanner.ScanCanvas.width,BarcodeScanner.ScanCanvas.height),BarcodeScanner.DecoderWorker.postMessage({scan:BarcodeScanner.ScanContext.getImageData(0,0,BarcodeScanner.ScanCanvas.width,BarcodeScanner.ScanCanvas.height).data,scanWidth:BarcodeScanner.ScanCanvas.width,scanHeight:BarcodeScanner.ScanCanvas.height,multiple:BarcodeScanner.Config.Multiple,decodeFormats:BarcodeScanner.Config.DecodeFormats,cmd:"normal",rotation:1})},StopStreamDecode:function(){BarcodeScanner.DecodeStreamActive=!1,BarcodeScanner.Decoded=[]},BarcodeScannerDecodeImage:function(a,e,n){8==e||6==e?"Landscape"==n&&a.width>a.height?(e=1,BarcodeScanner.ScanCanvas.width=640,BarcodeScanner.ScanCanvas.height=480):(BarcodeScanner.ScanCanvas.width=480,BarcodeScanner.ScanCanvas.height=640):(BarcodeScanner.ScanCanvas.width=640,BarcodeScanner.ScanCanvas.height=480),BarcodeScanner.DecoderWorker.onmessage=BarcodeScanner.BarcodeScannerImageCallback,BarcodeScanner.ScanContext.drawImage(a,0,0,BarcodeScanner.ScanCanvas.width,BarcodeScanner.ScanCanvas.height),BarcodeScanner.Orientation=e,BarcodeScanner.DecoderWorker.postMessage({scan:BarcodeScanner.ScanContext.getImageData(0,0,BarcodeScanner.ScanCanvas.width,BarcodeScanner.ScanCanvas.height).data,scanWidth:BarcodeScanner.ScanCanvas.width,scanHeight:BarcodeScanner.ScanCanvas.height,multiple:BarcodeScanner.Config.Multiple,decodeFormats:BarcodeScanner.Config.DecodeFormats,cmd:"normal",rotation:e,postOrientation:BarcodeScanner.PostOrientation})},DetectVerticalSquash:function(a){var e=a.naturalHeight,n=BarcodeScanner.SquashCanvas;n.width=1,n.height=e;var c=n.getContext("2d");c.drawImage(a,0,0);try{var r=c.getImageData(0,0,1,e).data}catch(a){return console.log("Cannot check verticalSquash: CORS?"),1}for(var o=0,t=e,d=e;d>o;){var i=r[4*(d-1)+3];0===i?t=d:o=d,d=t+o>>1}var S=d/e;return 0===S?1:S},FixCanvas:function(a){var e=a.getContext("2d"),n=e.drawImage;return e.drawImage=function(a,c,r,o,t,d,i,S,l){var s=1;a&&"IMG"==a.nodeName&&(s=BarcodeScanner.DetectVerticalSquash(a),o||(o=a.naturalWidth),t||(t=a.naturalHeight)),9==arguments.length?n.call(e,a,c,r,o,t,d,i,S,l/s):void 0!==o?n.call(e,a,c,r,o,t/s):n.call(e,a,c,r)},a}};